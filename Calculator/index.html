<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>金融相关计算工具</title>
		<link rel="stylesheet" type="text/css" href="css/style1.css"/>
		<script src="js/jquery-3.3.1.min.js"></script>
		<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
		<script src="./js/console.js" type="text/javascript"></script>
		<script>
			function showtime(){
			 let date=new Date($.ajax({async: false}).getResponseHeader("Date"));
			 let year=date.getFullYear();
			 let month=date.getMonth()+1;
			 let day=date.getDate();
			 let hour=date.getHours();
			 if(hour<10){
			  hour='0'+hour;
			 }
			 let minute=date.getMinutes();
			  if(minute<10){
			  minute='0'+minute;
			 }
			 let second=date.getSeconds();
			  if(second<10){
			  second='0'+second;
			 }
			 let time=year+'/'+month+'/'+day+' '+hour+':'+minute+':'+second;
			 
			 setTimeout(function(){
				 $("#time").text(time);
				 showtime();
			 },1000);
			 }
			 showtime();
		</script>
	</head>
	<body><div class="tab">
	<div id="time" style="border-style: inset; border: 15px 0; width: auto;"></div>
	<center><h1>没什么用的利率计算小工具</h1></center>
	<div class="tab_list">
		<ul>
			<li class="current" id=0>计算年化率</li>
			<li id=1>汇率换算</li>
			<li id=2>BTC比特币对冲比率
			</li>
			<li id=3>更多功能开发中</li>
		</ul>
		
	</div>
	<ul class="nav">
	  <li value=7 class="nave">
	    7天
	  </li>
	  <li value=14>
	   14天
	  </li>
	  <li value=30>
	    30天
	  </li>
	  <li value=60>
		  60天
	  </li>
	  <li value=90>
		  90天
	  </li>
	</ul>
	<div class="tab_con">
		<div class="item" id=0 style="display: block;">
			<form>
			<select id="mul">
				<option value=360>日利(首月不免息)</option>
				<option value=330 selected> 日利（首月免息）</option>
				<option value=12>月利</option>
			</select>
			<input type="text" id="rate" required="required" placeholder="利息"/>
			<span id="type-text">%</span>
			<select id="types">
				<option value=0 selected>百分比</option>
				<option value=1>金额</option>
			</select>
			<span class="sum">其中</span>
			<input id="sum" placeholder="本金" type="text" class="sum"/><span class="sum">元</span>
			<input type="button" id="start" value="开始计算"/>
			<div id="result">
				年化率计算结果为：
			<input type="text" id="re" disabled="disabled" placeholder="计算失败"/>%
			</div>
			</div>
			<div class="item" id=1 style="display: none;">
				<input type="text" id="money1" />
				<select id="monSel1">
          <option value="ARS">阿根廷比索ARS</option>
          <option value="AUD">澳元AUD</option>
          <option value="BGN">保加利亚列弗BGN</option>
          <option value="BRL">巴西雷亚尔BRL</option>
          <option value="BSD">白俄罗斯卢布BYR</option>
          <option value="CNY">人民币CNY</option>
          <option value="DKK">丹麦克朗DKK</option>
          <option value="EGP">埃及镑EGP</option>
          <option value="EUR">欧元EUR</option>
          <option value="FJD">斐济美元FJD</option>
          <option value="GBP">英镑GBP</option>
          <option value="GTQ">危地马拉格查儿GTQ</option>
          <option value="HKD">港元HKD</option>
          <option value="HRK">克罗地亚库纳HRK</option>
          <option value="HUF">匈牙利福林HUF</option>
          <option value="IDR">印尼盾IDR</option>
          <option value="ILS">以色列新锡克尔ILS</option>
          <option value="INR">印度卢比INR</option>
          <option value="ISK">冰岛克朗ISK</option>
          <option value="JPY">日元JPY</option>
          <option value="KRW">韩元KRW</option>
          <option value="KZT">哈萨克斯坦坚强戈KZT</option>
          <option value="MXN">墨西哥比索MXN</option>
          <option value="MYR">马来西亚林吉特MYR</option>
          <option value="NOK">挪威克朗NOK</option>
          <option value="NZD">新西兰元NZD</option>
          <option value="PAB">巴拿马巴波亚PAB</option>
          <option value="PEN">秘鲁索尔PEN</option>
          <option value="PHP">菲律宾比索PHP</option>
          <option value="PKR">巴基斯坦卢比PKR</option>
          <option value="PLN">波兰兹罗提PLN</option>
          <option value="PYG">巴拉圭瓜拉尼PYG</option>
          <option value="RON">罗马尼亚新列伊RON</option>
          <option value="RUB">卢布RUB</option>
          <option value="SAR">沙特阿拉伯人里亚尔SAR</option>
          <option value="SEK">瑞典克朗SEK</option>
          <option value="SGD">新加坡元SGD</option>
          <option value="THB">泰铢THB</option>
          <option value="TRY">新土耳其里拉TRY</option>
          <option value="TWD">新台币TWD</option>
          <option value="UAH">乌克兰格里夫纳UAH</option>
          <option value="USD" selected>美元USD</option>
          <option value="UYU">乌拉圭比索UYU</option>
          <option value="VND">越南盾VND</option>
          <option value="ZAR">南非兰特ZAR</option>
				</select>
				<br />
				相当于
				<br />
				<input type="text" id="money2" disabled/>
				<select id="monSel2">
					<option value="AED">阿联酋迪拉姆AED</option>
          <option value="ARS">阿根廷比索ARS</option>
          <option value="AUD">澳元AUD</option>
          <option value="BGN">保加利亚列弗BGN</option>
          <option value="BRL">巴西雷亚尔BRL</option>
          <option value="BSD">白俄罗斯卢布BYR</option>
          <option value="CNY" selected>人民币CNY</option>
          <option value="DKK">丹麦克朗DKK</option>
          <option value="EGP">埃及镑EGP</option>
          <option value="EUR">欧元EUR</option>
          <option value="FJD">斐济美元FJD</option>
          <option value="GBP">英镑GBP</option>
          <option value="GTQ">危地马拉格查儿GTQ</option>
          <option value="HKD">港元HKD</option>
          <option value="HRK">克罗地亚库纳HRK</option>
          <option value="HUF">匈牙利福林HUF</option>
          <option value="IDR">印尼盾IDR</option>
          <option value="ILS">以色列新锡克尔ILS</option>
          <option value="INR">印度卢比INR</option>
          <option value="ISK">冰岛克朗ISK</option>
          <option value="JPY">日元JPY</option>
          <option value="KRW">韩元KRW</option>
          <option value="KZT">哈萨克斯坦坚强戈KZT</option>
          <option value="MXN">墨西哥比索MXN</option>
          <option value="MYR">马来西亚林吉特MYR</option>
          <option value="NOK">挪威克朗NOK</option>
          <option value="NZD">新西兰元NZD</option>
          <option value="PAB">巴拿马巴波亚PAB</option>
          <option value="PEN">秘鲁索尔PEN</option>
          <option value="PHP">菲律宾比索PHP</option>
          <option value="PKR">巴基斯坦卢比PKR</option>
          <option value="PLN">波兰兹罗提PLN</option>
          <option value="PYG">巴拉圭瓜拉尼PYG</option>
          <option value="RON">罗马尼亚新列伊RON</option>
          <option value="RUB">卢布RUB</option>
          <option value="SAR">沙特阿拉伯人里亚尔SAR</option>
          <option value="SEK">瑞典克朗SEK</option>
          <option value="SGD">新加坡元SGD</option>
          <option value="THB">泰铢THB</option>
          <option value="TRY">新土耳其里拉TRY</option>
          <option value="TWD">新台币TWD</option>
          <option value="UAH">乌克兰格里夫纳UAH</option>
          <option value="USD">美元USD</option>
          <option value="UYU">乌拉圭比索UYU</option>
          <option value="VND">越南盾VND</option>
          <option value="ZAR">南非兰特ZAR</option>
				</select>
			</div>
			<div class="item" id=2 style="display: none;">
			<table>
			  <thead>
				  <tr>
				  	<th colspan="6" id="delta">delta=</th>
				  </tr>
			    <tr>
			      <th>编号</th>
			      <th>开盘价</th>
			      <th>收盘价</th>
			      <th>峰值</th>
			      <th>最低值</th>
			      <th>总数</th>
			    </tr>
			  </thead>
			  <tbody>
				  <tr><td colspan="6">网络连接失败，请开启代理后重试</td></tr>
			  </tbody>
			  </table>
			</div>
			<div class="item" id=3 style="display: none;">
				头发要掉光了
				<img src="img/wuwuwu.jpg" />
			</div>
		</div>
	</div>

	</body>
	<script>
		
		
		//变量库
		let mode=$(".current").index();
		let types=$("#types").val();
		let mul=$("#mul").val();
		let monmul1=$("#monSel1").val();
		let monmul2=$("#monSel2").val();
		let fix=4;
		let days=7;
		let BTC=Array();
		let Concarct=Array();
		let BTC_data=Array();
		// let BTC_data={
		// ["id":1619798400,"open":59480.5,"close":60143.3,"low":58538.96,"high":60751.99,"amount":33766.1646981174066088971241378617979870094,"vol":20186474,"count":240020],
		// ["id":1619798400,"open":59480.5,"close":60143.3,"low":58538.96,"high":60751.99,"amount":33766.1646981174066088971241378617979870094,"vol":20186474,"count":240020],
		// }
		
		let Concarct_data=Array();
		// let Concarct_data={
		// 	"id":1619798100,"open":59480.5,"close":60143.3,"low":58538.96,"high":60751.99,"amount":33766.1646981174066088971241378617979870094,"vol":20186474,"count":240020
		// }
		let BTC_ratestd;
		let Concarct_ratestd;
		let delta;
		
		console.log(BTC_data[1]);
		//开始执行函数
		$(".sum").hide();
		$("#result").hide();
		$("#money1").val(1);
		getRate(monmul1,monmul2);
		getBTC(2000);
		getContarct(2000);
		drawTable(30);
		
		
		//侦听器注册
		
		//年化率计算
		$(".tab_list ul li").mouseenter(function(){
			$(".current").removeClass("current");
			$(this).addClass("current");
		});
		$(".tab_list ul li").mouseout(function(){
			let lis=".tab_list ul li:eq("+mode+")";
			$(".current").removeClass("current");
			$(lis).addClass("current");
		});
		$(".tab_list ul li").click(function(){
			mode=$(this).index();
			$(".item").hide();
			$(".item").eq(mode).show();
			if(mode==2)$(".nav").show();else $(".nav").hide();
		});
		$(".nav li").mouseenter(function(){
			$(".nave").removeClass("nave");
			$(this).addClass("nave");
		})
		$(".nav li").mouseout(function(){
			$(".nave").removeClass("nave");
			$("[value="+days+"]").addClass("nave");
			
		});
		$(".nav li").click(function(){
			days=$(this).val();
			$(".nave").removeClass("nave");
			$("[value="+days+"]").addClass("nave");
			
		});
		$("#types").change(function(){
			types=$(this).val();
			if(types==0){$("#type-text").text("%");$(".sum").hide()}
			else
			{
				$("#type-text").text("元");
				$(".sum").show();
			}
			});
		$("#mul").change(function(){
			mul=$(this).val();
		})
		$("#start").click(function(){
			if(types==0){
				if(isNaN(parseFloat($("#rate").val()))){$("#rate").val("");alert("???啊这？",history.go(-1));return}
				let rates=parseFloat($("#rate").val())/100 + 1
				$("#re").val(Math.pow(rates,mul)-1);
				$("#result").show();
			}
			else
			{
				if(isNaN(parseFloat($("#rate").val())) || isNaN(parseFloat($("#sum").val()))){alert("???啊这？",history.go(-1));$("#rate").val("");$("#sum").val("");}
				let raxs=parseFloat($("#rate").val());let base=parseFloat($("#sum").val());
				console.log(base);
				let ratess=raxs/base+1;
				$("#re").val(Math.pow(ratess,mul)-1);
				$("#result").show();
			}
		});
		
		//汇率换算
		$("#monSel1").change(function(){
			monmul1=$("#monSel1").val();
			getRate(monmul1,monmul2);
		});
		$("#monSel2").change(function(){
		monmul2=$("#monSel2").val();
		getRate(monmul1,monmul2);
		});
		$("#money1").focus(function(){
			getRate(monmul1,monmul2)
		});
		$("#money1").blur(function(){
			getRate(monmul1,monmul2)
		});
		
		
		//函数
		
		
		//计算标准差的函数
		function std(arr,fix,flag){
			let sd,ave,sum=0;sums=0;len=arr.length;
			for(let i=0;i<len;i++){
				sum=Number(arr[i])
			}
			ave=sum/len;
			for(let i=1;i<len;i++){
				sums=(Number(arr[i])-ave)*(Number(arr[i])-ave)
			}if(flag)
			sd=(Math.sqrt(sums/len)).toFixed(fix);else sd=(Math.sqrt(sums/len));
			return sd;
			}
			
			//获取BTC数组
			function getBTC(size){
				fetch(`https://api.huobi.pro/market/history/kline?symbol=btcusdt&period=1day&size=${size}`).then(res=>res.json()).then(data=>
				{
					BTC_data=data;
					for(let i=0;i<size;i++){
						BTC=data.data[i]["close"];
						}
						
				})
			}
			
			//获取期货数组
			function getContarct(size){
				fetch(`https://api.hbdm.com/market/history/kline?symbol=BTC_CQ&period=1day&size=${size}`).then(res=>res.json()).then(data=>
				{ Concarct_data=data;
					for( let i=0;i<size;i++){
					Concarct=data.data[i]["close"];
					}
					Concarct.reverse();
				})
			}
			
			//数组求ln函数
			function getlog(arr,fix,flag){
				for(let i=0;i<arr.length;i++) if(flag) arr[i]=Math.log(arr[i]).toFixed(fix);else arr[i]=Math.log(arr[i]);
				return arr;
			}
			
			let a=Array(9,9,9);
			
			//获取收益率标准差
			function getDelta(){
				a=getlog(BTC,1,false);b=getlog(Concarct,1,false);
				let c=Array(),d=Array();
				for( let i=1;i<days;i++){
					c.push(a[i]-a[i-1]);
					d.push(b[i]-b[i-1]);
				}
				BTC_ratestd=getlog(c,1,false);
				Concarct_ratestd=getlog(d,1,false);
				delta=BTC_ratestd/Concarct_ratestd;
			}
			
			//绘制表格
			function drawTable(fetch){
				if(BTC_data.length==0 || Concarct_data.length==0)return;
				$("tbody").empty(); let max;
				if(BTC_data.length>fetch)max=BTC_data.length;else max=fetch;
				for(let i=0;i<max;i++){
					console.log(BTC_data[i]["id"]);
					$("tbody").append(
					"<tr> <td>"+BTC_data[i]["id"]+"</td><td>"+BTC_data[i]["open"]+"</td> <td>"+BTC_data[i]["close"]+"</td> <td>"+BTC_data[i]["hight"]+"</td> <td>"+BTC_data[i]["low"]+"</td> <td>"+BTC_data[i]["count"]+"</td> </tr>"
					)
				}
			}
			
	</script>
</html>
